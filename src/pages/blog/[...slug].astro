---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content, headings } = await render(post);

// Get all posts sorted by date (newest first)
const allPosts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Find current post index
const currentIndex = allPosts.findIndex((p) => p.id === post.id);

// Get previous and next posts (previous = newer, next = older)
const prevPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
const nextPost =
  currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;

// Format for navigation component
const prevPostData = prevPost
  ? { slug: prevPost.id, title: prevPost.data.title }
  : null;
const nextPostData = nextPost
  ? { slug: nextPost.id, title: nextPost.data.title }
  : null;
---

<BlogPost
  {...post.data}
  headings={headings}
  prevPost={prevPostData}
  nextPost={nextPostData}
>
  <Content />
</BlogPost>
