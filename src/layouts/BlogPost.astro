---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// Calculate reading time (rough estimate)
const content = Astro.slots.has("default")
  ? await Astro.slots.render("default")
  : "";
const wordCount = content.split(/\s+/).length;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<BaseLayout title={title} description={description}>
  <main>
    <article class="blog-post">
      <!-- Header -->
      <header class="post-header reveal">
        <div class="post-meta">
          <time datetime={pubDate.toISOString()}>
            <FormattedDate date={pubDate} />
          </time>
          <span class="separator">Â·</span>
          <span class="reading-time">{readingTime} min read</span>
        </div>
        <h1 class="post-title">{title}</h1>
        {description && <p class="post-description">{description}</p>}
      </header>

      <!-- Hero Image -->
      {
        heroImage && (
          <div class="hero-image reveal">
            <img src={heroImage.src} alt={title} />
          </div>
        )
      }

      <!-- Content -->
      <div class="prose reveal">
        {
          updatedDate && (
            <p class="updated-notice">
              <em>
                Last updated on <FormattedDate date={updatedDate} />
              </em>
            </p>
          )
        }
        <slot />
      </div>

      <!-- Footer -->
      <footer class="post-footer reveal">
        <a href="/blog" class="back-link">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          <span>Back to Blog</span>
        </a>
      </footer>
    </article>
  </main>
</BaseLayout>

<style>
  main {
    padding-top: var(--space-12);
    padding-bottom: var(--space-16);
    max-width: 680px;
  }

  .blog-post {
    width: 100%;
  }

  /* Header */
  .post-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }

  .post-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
  }

  .separator {
    opacity: 0.5;
  }

  .post-title {
    font-size: clamp(var(--text-2xl), 5vw, var(--text-4xl));
    line-height: 1.15;
    margin-bottom: var(--space-4);
  }

  .post-description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin: 0;
    max-width: 540px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Hero Image */
  .hero-image {
    margin-bottom: var(--space-10);
    margin-left: calc(var(--space-6) * -1);
    margin-right: calc(var(--space-6) * -1);
  }

  .hero-image img {
    width: 100%;
    height: auto;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
  }

  /* Prose */
  .prose {
    margin-bottom: var(--space-12);
  }

  .updated-notice {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-8);
  }

  /* Footer */
  .post-footer {
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-border);
  }

  @media (max-width: 640px) {
    main {
      padding-top: var(--space-8);
    }

    .hero-image {
      margin-left: calc(var(--space-4) * -1);
      margin-right: calc(var(--space-4) * -1);
    }

    .hero-image img {
      border-radius: var(--radius-lg);
    }
  }
</style>
