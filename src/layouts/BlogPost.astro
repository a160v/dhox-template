---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import TableOfContents from "../components/TableOfContents.astro";
import Footer from "../components/Footer.astro";

type Props = CollectionEntry<"blog">["data"] & {
  headings?: { depth: number; slug: string; text: string }[];
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  headings = [],
  tags = [],
} = Astro.props;

// Breadcrumb data for footer
const breadcrumbs = [
  { label: "Home", href: "/" },
  { label: "Blog", href: "/blog" },
  { label: title },
];
---

<BaseLayout title={title} description={description}>
  <main id="main-content">
    <article class="blog-post">
      <!-- Header -->
      <header class="post-header reveal">
        <h1 class="post-title">{title}</h1>
        {description && <p class="post-description">{description}</p>}
        <div class="post-meta">
          <a
            href={tags.length > 0 ? `/blog/tag/${tags[0]}` : "/blog"}
            class="post-type"
          >
            {
              tags.length > 0
                ? tags
                    .map((tag) => tag.charAt(0).toUpperCase() + tag.slice(1))
                    .join(", ")
                : "Article"
            }
          </a>
          <span class="separator">Â·</span>
          <time datetime={pubDate.toISOString()}>
            <FormattedDate date={pubDate} />
          </time>
        </div>
      </header>

      <!-- Content -->
      <div class="prose reveal">
        <!-- Table of Contents Accordion -->
        {headings.length > 0 && <TableOfContents headings={headings} />}

        {
          updatedDate && (
            <p class="updated-notice">
              <em>
                Last updated on <FormattedDate date={updatedDate} />
              </em>
            </p>
          )
        }
        <slot />
      </div>
    </article>

    <!-- Footer with breadcrumb and datetime -->
    <Footer breadcrumbs={breadcrumbs} />
  </main>
</BaseLayout>

<style>
  main {
    padding-top: var(--space-12);
    padding-bottom: var(--space-16);
    max-width: 680px;
    margin: 0 auto;
  }

  .blog-post {
    width: 100%;
  }

  /* Header */
  .post-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }

  .post-title {
    font-size: clamp(var(--text-2xl), 5vw, var(--text-4xl));
    line-height: 1.15;
    margin-bottom: var(--space-4);
    font-weight: 700;
  }

  .post-description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin: 0 0 var(--space-6) 0;
    line-height: 1.6;
  }

  .post-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .post-type {
    color: var(--color-text-muted);
    text-decoration: none;
    font-weight: 500;
    letter-spacing: 0.05em;
    transition: color var(--transition-fast);
  }

  .post-type:hover {
    color: var(--color-accent);
  }

  .post-meta .separator {
    opacity: 0.5;
  }

  .prose {
    width: 100%;
  }

  /* Prose Styling */
  .updated-notice {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-8);
  }

  @media (max-width: 640px) {
    main {
      padding-top: var(--space-8);
    }
  }
</style>
