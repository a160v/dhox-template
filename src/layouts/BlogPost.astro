---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import TableOfContents from "../components/TableOfContents.astro";

type Props = CollectionEntry<"blog">["data"] & {
  headings?: { depth: number; slug: string; text: string }[];
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  headings = [],
  tags = [],
} = Astro.props;
---

<BaseLayout title={title} description={description}>
  <main>
    <article class="blog-post">
      <!-- Header -->
      <header class="post-header reveal">
        <h1 class="post-title">{title}</h1>
        {description && <p class="post-description">{description}</p>}
        <div class="post-meta">
          <a
            href={tags.length > 0 ? `/blog/tag/${tags[0]}` : "/blog"}
            class="post-type"
          >
            {
              tags.length > 0
                ? tags
                    .map((tag) => tag.charAt(0).toUpperCase() + tag.slice(1))
                    .join(", ")
                : "Article"
            }
          </a>
          <span class="separator">·</span>
          <time datetime={pubDate.toISOString()}>
            <FormattedDate date={pubDate} />
          </time>
        </div>
      </header>

      <!-- Content Wrapper -->
      <div class="content-wrapper">
        <div class="prose reveal">
          <!-- Table of Contents Accordion -->
          {headings.length > 0 && <TableOfContents headings={headings} />}

          {
            updatedDate && (
              <p class="updated-notice">
                <em>
                  Last updated on <FormattedDate date={updatedDate} />
                </em>
              </p>
            )
          }
          <slot />
        </div>
      </div>

      <!-- Footer -->
      <footer class="post-footer reveal">
        <nav class="breadcrumb-classic" aria-label="Breadcrumb">
          <a href="/">Home</a>
          <span class="separator">›</span>
          <a href="/blog">Blog</a>
          <span class="separator">›</span>
          <span class="current" aria-current="page">{title}</span>
        </nav>
      </footer>
    </article>
  </main>
</BaseLayout>

<style>
  main {
    padding-top: var(--space-12);
    padding-bottom: var(--space-16);
    max-width: 680px;
    margin: 0 auto;
  }

  .blog-post {
    width: 100%;
  }

  /* Header */
  .post-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }

  .post-title {
    font-size: clamp(var(--text-2xl), 5vw, var(--text-4xl));
    line-height: 1.15;
    margin-bottom: var(--space-4);
    font-weight: 700;
  }

  .post-description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin: 0 0 var(--space-6) 0;
    line-height: 1.6;
  }

  .post-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .breadcrumb-classic {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .breadcrumb-classic a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .breadcrumb-classic a:hover {
    color: var(--color-accent);
  }

  .breadcrumb-classic .separator {
    opacity: 0.5;
    font-size: var(--text-xs);
  }

  .breadcrumb-classic .current {
    color: var(--color-text);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 300px;
  }

  .post-type {
    color: var(--color-text-muted);
    text-decoration: none;
    font-weight: 500;
    letter-spacing: 0.05em;
    transition: color var(--transition-fast);
  }

  .post-type:hover {
    color: var(--color-accent);
  }

  .post-meta .separator {
    opacity: 0.5;
  }

  /* One Column Content */
  .content-wrapper {
    width: 100%;
  }

  .prose {
    width: 100%;
  }

  /* Prose Styling */
  .updated-notice {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-8);
  }

  /* Footer */
  .post-footer {
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-border);
    margin-top: var(--space-12);
  }

  @media (max-width: 640px) {
    main {
      padding-top: var(--space-8);
    }
  }
</style>
